{% extends parent_template %}

<!-- LOADING -->
{% load i18n adminmedia %}

{% block extrahead %}
    {{ block.super }}
    {{ crop_form.media }}
    {{ thumb_formset.media }}
{% endblock %}

<!-- Get rid of nav -->
{% block nav-global %}{% endblock %}

{% block bodyclass %}{{ block.super }} cropduster-upload-form absolute-pos{% endblock %}

{% block content-class %}content-flexible{% endblock %}

{% block breadcrumbs %}{% endblock %}


<!-- CONTENT -->
{% block content %}
<h1 id="step-header">Upload, Crop, and Generate Thumbnails</h1>
<div id="content-main">
    <form id="upload" action="{% url cropduster.views.upload %}?upload_to={{ upload_to|urlencode }}" method="POST">
        <fieldset class="module aligned">
            {% for field in upload_form %}
                <div class="row {{ field.name }}{% if field.name != 'image' %} hidden{% endif %}">
                    {% if field.name != "image" %}{{ field.label_tag|safe }}{% endif %}
                    {{ field }}
                </div>
            {% endfor %}
        </fieldset>
    </form>

    <div id="error-container" style="display:none">
        <p class="errornote"></p>
    </div>

    <form action="{% url cropduster.views.crop %}" method="POST" id="crop-form">
        <div id="image-container">
            <img src="{{ image }}" id="cropbox" />
        </div>
        <div id="thumb-formset-container">
            {{ crop_form.as_p }}
            <div class="cropduster-thumb-formset" id="{{ thumb_formset.prefix }}-group">
                {{ thumb_formset.management_form }}
                {% for thumb_form in thumb_formset %}
                <div class="cropduster-thumb-form" id="{{ thumb_formset.prefix }}-{{ forloop.counter0 }}">
                    <table>{{ thumb_form }}</table>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="module footer">
            <div id="crop-nav">
                <div id="nav-left" class="rounded-button disabled"><span></span></div>
                <div id="nav-right" class="rounded-button disabled"><span></span></div>
            </div>
            <div id="current-thumb-info">
                <div id="current-thumb-index"></div>
                <div id="thumb-total-count"></div>
                <div id="current-thumb-label"></div>
            </div>
            <ul class="submit-row" id="upload-footer"{% if not image_id %} style="display: none"{% endif %}>
                <li class="submit-button-container">
                    <input id="upload-button" class="rounded-button disabled" type="submit" name="_save" value='Upload'  onclick="return uploadSubmit();"/>
                </li>
            </ul>
            <ul class="submit-row" id="crop-footer"{% if image_id %} style="display: none"{% endif %}>
                <li class="submit-button-container">
                    <input id="crop-button" class="rounded-button" type="submit" name="crop" value="Crop and Continue" />
                </li>
                <li class="submit-button-container">
                    <input id="reupload-button" class="rounded-button disabled" type="submit" name="_save" value='Re-Upload' onclick="return uploadSubmit();" />
                </li>
            </ul>
        </div>
    </form>

</div>
{% endblock %}